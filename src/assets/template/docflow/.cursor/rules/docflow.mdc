---
description: Outline of Docflow workflow and rules to follow.
globs:
alwaysApply: true
---
# DocFlow Workflow Rules

## Context Loading Priority
1. Always load: /docflow/context/overview.md
2. Always load: /docflow/ACTIVE.md
3. For current work: Load active spec from /docflow/specs/active/
4. For technical details: Load /docflow/context/stack.md and standards.md
5. For shared code: Load /docflow/shared/dependencies.md

## CRITICAL: File Movement Rules (MUST FOLLOW)

### Rule 1: Always Move Files Atomically
When moving specs between folders, ALWAYS:
1. **Delete the source file FIRST**
2. **Then create the destination file** 
3. **NEVER copy without deleting** (this creates duplicates)

### Rule 2: Update INDEX.md IMMEDIATELY
Every time you move a spec file, update INDEX.md in the SAME operation:
- Remove from old section (Active/Backlog/Completed)
- Add to new section with status and date
- Update priority order if needed

### Rule 3: Update ACTIVE.md IMMEDIATELY  
Every time you move a spec file, update ACTIVE.md in the SAME operation:
- Remove completed items from Primary Focus/Secondary
- Add new active items to Primary Focus/Secondary
- Update Last Updated timestamp

### Rule 4: Automatic File Movement Triggers
Move specs automatically when these conditions are met:

**Backlog → Active:**
- When user says "start working on [spec]" or "activate [spec]"
- When spec is referenced as current focus
- When `/start-session` moves item to active

**Active → Complete:**
- When ALL acceptance criteria are marked complete [x]
- When user says "done with [spec]" or "complete [spec]"
- When `/wrap-session` completes an item
- When user moves to different work

**Complete Archiving:**
- Move to /complete/YYYY-QQ/ at end of each quarter
- Or immediately if explicitly requested

### Rule 5: Prevent Duplicates
- Before creating any spec file, check if it exists in ANY folder
- If found, update existing file instead of creating new one
- If moving, delete source before creating destination

### Rule 6: Incremental Updates
Update INDEX.md and ACTIVE.md immediately when:
- Adding new specs to backlog
- Moving specs between folders
- Completing acceptance criteria
- Starting/stopping work on items

## Workflow Commands
The following commands are available in `.cursor/commands/`:
- `/start-session` - Begin work session, check status, start new work
- `/wrap-session` - Save progress and checkpoint current work
- `/capture` - Quickly capture new ideas/features/bugs to backlog
- `/review` - Review and refine backlog items for active work

Type `/` in chat to see and use these commands.

## Conversational Command Triggers

### Start Session Triggers
When user says any of these, run `/start-session`:
- "let's start" / "let's get started" / "let's begin"
- "start a session" / "start my session" / "start work"
- "what should I work on" / "what's next"
- "begin work" / "begin my day"
- "let's code" / "ready to code"
- "what am I working on"
- "resume work" / "continue working"
- Opening a new conversation (suggest: "Would you like to /start-session?")

### Wrap Session Triggers  
When user says any of these, run `/wrap-session`:
- "let's wrap" / "wrap it up" / "wrap up"
- "I'm done" / "done for now" / "done for the day"
- "stopping" / "taking a break" / "heading out"
- "save progress" / "checkpoint"
- "end session" / "close session"
- "let's stop" / "time to stop"
- "call it a day" / "that's it for now"
- "pause work" / "pause here"

### Capture Triggers
When user says any of these, run `/capture`:
- "capture that" / "let's capture" / "we should capture"
- "add to backlog" / "save that idea"
- "I have an idea" / "new idea"
- "found a bug" / "there's a bug"
- "we should add" / "let's add a feature"
- "make a note" / "note this"
- "remember to" / "don't forget"
- "TODO" / "FIXME" (in conversation)
- When user describes something that sounds like a feature/bug/idea, ask: "Should I /capture this?"

### Review Triggers
When user says any of these, run `/review`:
- "review [item]" / "let's review"
- "refine [item]" / "prepare [item]"
- "is [item] ready" / "check [item]"
- "look at backlog" / "check backlog"
- "what needs work" / "what needs refinement"
- "get [item] ready" / "prep [item]"
- "audit backlog" / "clean up backlog"

## Automatic Command Suggestions

### Contextual Suggestions
- **Empty ACTIVE.md + Items in backlog** → "I see you have items in backlog. Shall we /review one?"
- **Completed all acceptance criteria** → "Looks like you've finished! Ready to /wrap-session?"
- **Switching context** → "Before we switch, should we /wrap-session on current work?"
- **Vague feature description** → "Interesting idea! Should I /capture this for later?"
- **Multiple specs in active** → "You have multiple active items. Let's /start-session to focus on one?"

### Natural Language Recognition
When detecting these patterns in conversation:
- **"That would be cool if..."** → Suggest /capture as idea
- **"It's broken when..."** → Suggest /capture as bug  
- **"We need to..."** → Suggest /capture as feature
- **"The problem is..."** → Could be bug or feature, ask which to /capture
- **"What if we..."** → Suggest /capture as idea

## Before Creating ANY New Code

### Check Existing Code
1. Review /docflow/shared/dependencies.md for existing functionality
2. For TypeScript: Check existing modules in /src
3. For Utils: Check if utility function exists in /src/utils

### If Creating New Shared Code
1. Add entry to /docflow/shared/dependencies.md immediately
2. Note which feature/bug created it
3. Document who uses it

## When Working on Specs

### Starting New Work
1. Spec must exist in /docflow/specs/active/
2. Update ACTIVE.md with current focus
3. Review dependencies in the spec
4. Create feature/bug branch matching spec name

### During Implementation
1. Update spec's Decision Log with key decisions and pivots
2. Update Dependencies if new connections found
3. Keep Acceptance Criteria current
4. If blocked, note in spec and ACTIVE.md

### Completing Work
1. Verify all Acceptance Criteria met
2. Update INDEX.md with completion date
3. Add final Decision Log entry with outcomes
4. **DELETE original file from /specs/active/**
5. **CREATE new file in /specs/complete/[YYYY-QQ]/**
6. Update ACTIVE.md to remove completed item

## Code Principles
- TypeScript strict mode always
- No duplicate functions - use shared utilities
- Modular architecture - small, focused modules
- Every shared module tracked in dependencies.md
- Follow standards.md for all code conventions

## Decision Documentation
When making technical decisions, always update the Decision Log:
- Architecture choices (why X over Y)
- Scope changes (what was cut and why)
- Performance trade-offs
- Security considerations
- Breaking changes
- External dependencies added

## Natural Capture During Work
If user mentions something that could be a bug, feature, or idea during active work:
1. Recognize it based on context clues
2. Ask: "That sounds like a [type]. Should I /capture this?"
3. If yes, run capture command with quick capture format
4. Continue with current work without context switching

## Status Awareness
Always be aware of:
- What's currently active (ACTIVE.md)
- What's in the backlog (INDEX.md)
- What's blocking progress (check specs)
- What decisions need to be made (check Decision Logs)

## Response Patterns
Before creating code, always state:
"Let me check dependencies.md for existing [functionality]..."

When finding existing code:
"Found existing [module/function] in dependencies.md that handles this"

When creating new shared code:
"Creating new [module/function]. I'll add this to dependencies.md"

## Command Execution Patterns
When recognizing a trigger phrase:
1. Acknowledge the intent: "Let me help you [start/wrap/capture/review]..."
2. Execute the appropriate command
3. Follow the command's checklist completely
4. Confirm completion

Never say "you should run /command" - instead, recognize the intent and run it directly.

## Maintain Consistency
- Always follow patterns in stack.md
- Always follow conventions in standards.md
- Always update decision logs with reasoning
- Always keep ACTIVE.md current
- Always keep INDEX.md current
- Always move files atomically (delete source, create destination)
- Recognize natural language and execute commands accordingly
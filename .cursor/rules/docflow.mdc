---
alwaysApply: true
---

# Docflow CLI - Conversational AI Documentation Generator

## Project Context

This is the Docflow CLI tool for generating AI-powered project documentation. The project is evolving from template-based generation to conversational AI-driven documentation creation.

## Current State

- **Implemented**: Template-based documentation generation with AI content filling
- **Status**: Planning conversational AI enhancement (v2.0)
- **Documentation**: Complete project specs in `/docflow/`

## Key Documentation

### Project Understanding
- Read `/docflow/project/specs.md` for high-level vision
- Read `/docflow/project/architecture.md` for technical design
- Read `/docflow/project/design.md` for UX patterns

### Current Development
- Read `/docflow/releases/current/index.md` for release plan
- Read `/docflow/releases/current/features.md` for detailed features
- Read `/docflow/active/focus.md` for current priorities
- Read `/docflow/notes/` for recent decisions and session context (check today's file first, then yesterday's if needed)

### Workflow Protocols
- Follow `/docflow/project/workflows.md` for WrapSession, StartSession, and CaptureNote protocols
- Follow Active Feature Lifecycle for systematic feature development

### Active Feature Management
**ALWAYS check `/docflow/active/focus.md` first** - this defines your current work priority

#### Auto-Progression Logic
1. **If focus.md is empty or feature completed**: Auto-pull next P0 feature from `/docflow/releases/current/features.md`
2. **Update feature status**: Change from `pending` â†’ `active` in features.md  
3. **Create focused todos**: Generate 3-5 specific, actionable todos in focus.md
4. **Set status**: Mark as `in_progress` and begin systematic work

#### Feature Status Management
- **in_progress**: Working through todos systematically
- **in_review**: All todos complete, ready for user testing/feedback
- **completed**: User approved, ready to archive and move to next feature

#### Documentation Updates
- Update `/docflow/active/focus.md` with progress after each work session
- Mark todos as âœ… immediately when completed  
- Update features.md with current status and completed items
- Use CaptureNote protocol for major decisions during development

### Documentation Philosophy
- Read the "Documentation Philosophy & Structure" section in `README.md`
- Follow the information hierarchy: specs â†’ features â†’ implementation â†’ docs updated

## Architecture Overview

```
cli/src/
â”œâ”€â”€ commands/          # CLI command handlers
â”œâ”€â”€ prompts/           # User interaction (to be enhanced with conversation)
â”œâ”€â”€ generators/        # AI content generation (to be enhanced)
â”œâ”€â”€ templates/         # Template system (to be replaced with purposes)
â”œâ”€â”€ ui/                # Terminal UI components
â””â”€â”€ index.ts           # Main CLI entry point
```

## Current Enhancement Approach

**Goal**: Transform from template-based to conversational AI documentation generation

**Strategy**: Gradual enhancement approach
1. Add conversational mode alongside existing templates
2. Test and refine conversational approach
3. Replace template system with conversational as default

## Key Implementation Areas

### Major Modifications Needed
- `src/prompts/project.ts` - Replace form prompts with conversation engine
- `src/generators/ai-generator.ts` - Enhance from section-filling to purpose-driven
- `src/generators/docs.ts` - Replace template processing with conversational workflow

### New Components Required
- `src/conversation/` - Conversation engine and phase management
- `src/context/` - Context management and persistence
- `src/purposes/` - Document purpose framework

## Development Guidelines

### Code Standards
- TypeScript with strict settings
- Functional, composable architecture
- Error handling with graceful fallbacks
- Beautiful CLI experience with Clack
- Comprehensive JSDoc comments

### AI Integration
- Support OpenAI, Anthropic, and local models
- Context-aware prompting with project specifics
- Efficient API usage with caching and retries
- Fallback strategies for API failures

### User Experience
- Natural conversation flows
- Clear progress indicators
- Graceful error handling and recovery
- Iterative refinement capabilities

## Testing Strategy

- Test with diverse project types and sizes
- Validate AI conversation quality and context retention
- Ensure backward compatibility during transition
- Performance testing for conversation and generation

## Implementation Priority

**Phase 1: Conversation Engine**
- Complexity: High - New conversation architecture
- Dependencies: None - Fresh implementation
- Build conversation framework with context management
- Implement project discovery workflow
- Add user validation and refinement

**Phase 2: Document Purpose System**
- Complexity: Medium - Template system replacement
- Dependencies: Phase 1 context management
- Replace templates with purpose-driven generation
- Add stakeholder-specific content tailoring
- Ensure cross-document consistency

**Phase 3: Integration & Polish**
- Complexity: Medium - UX and performance optimization
- Dependencies: Phases 1 & 2 complete
- Connect conversation to documentation generation
- Add iterative refinement capabilities
- Optimize performance and user experience

## Success Criteria

- 90%+ user satisfaction vs template approach
- Complete documentation generation under 10 minutes
- Maintains context across 50+ conversation turns
- Documentation requires minimal manual editing

---

## Session Notes & Decision Records

For significant changes, scope modifications, or architectural decisions, add timestamped entries to the appropriate daily file in `/docs/notes/`:

**Entry Types:**
- `DECISION RECORD`: Major architectural or implementation decisions
- `SCOPE CHANGE`: Modifications to project scope or timeline  
- `NOTE`: Important insights or design discoveries
- `CHANGE`: Structural or process changes

**Format:** Follow CaptureNote Protocol in `/docs/project/workflows.md`

**Quick Reference:**
```
## HH:MM - ENTRY TYPE: Brief Description
**Type:** Category
**Impact:** High/Medium/Low - Area affected
**Rationale:** Why this change/decision was made
**Affects:** What systems/processes this impacts
```

## StartSession Protocol

When asked "where are we and what's next?", provide:

**ðŸŽ¯ Current Status**
- Phase: [Current development phase]
- Priority: [P0/P1/P2] [Current high-priority task]
- Blockers: [Any immediate blockers or dependencies]

**âš¡ Next Actions**
1. [Immediate next task - specific and actionable]
2. [Secondary task if first is blocked]
3. [Third option/alternative approach]

**ðŸš¨ Alerts**
[Any urgent issues, breaking changes, or critical dependencies]

When working on this project, always consider the conversational enhancement goals and refer to the comprehensive documentation in `/docs/` for context and requirements.